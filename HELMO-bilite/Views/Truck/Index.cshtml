@model IEnumerable<Truck>
@{
    ViewBag.Title = "Liste des camions";
}
<div class="h-100 vw-100 p-5">
    <div class="container mt-3">
        <div class="row">
            <div class="col-12 text-center mb-3">
                <h2>Liste des camions</h2>
            </div>
            @if (TempData["NotificationMessage"] != null)
            {
                <div class="alert alert-success">
                    @TempData["NotificationMessage"]
                </div>
            }
            @if (TempData["DeleteErrorMessage"] != null)
            {
                <div class="alert alert-danger">
                    @TempData["DeleteErrorMessage"]
                </div>
            }
            <div class="col-12 text-center mb-3">
                <a href="@Url.Action("Create", "Truck")" class="btn btn-warning fw-bold">
                    Ajouter un camion
                </a>
            </div>
        </div>
        <table class="table table-striped table-bordered border-5">
            <thead class="bg-warning">
            <tr>
                <th scope="col"><i class="fas fa-camera"></i> Photo</th>
                <th scope="col"><i class="fa-solid fa-truck"></i> Marque</th>
                <th scope="col"><i class="fas fa-book"></i> Modèle</th>
                <th scope="col"><i class="far fa-file-alt"></i> Plaque d'immatriculation</th>
                <th scope="col"><i class="fa-solid fa-id-card"></i> Type de permis requis</th>
                <th scope="col"><i class="fa-solid fa-weight-scale"></i> Tonnage maximum</th>
                <th scope="col"><i class="fa-solid fa-list-ul"></i> Actions</th>
            </tr>
            </thead>
            <tbody>
            @foreach (var truck in Model)
            {
                <tr>
                    <td>
                        <button class="btn btn-primary btn-sm fw-bold" data-bs-toggle="modal" data-bs-target="#viewTruckImageModal" data-bs-img="@Url.Content(truck.PictureTruckPath)">Voir photo</button>
                    </td>
                    <td>@truck.Brand</td>
                    <td>@truck.Model</td>
                    <td>@truck.NumberPlate</td>
                    <td>@truck.RequiredDrivingLiscence</td>
                    <td>@truck.MaximumTonnage</td>
                    <td>
                        <a href="@Url.Action("Edit", "Truck", new { id = truck.IdTruck })" class="btn btn-warning btn-sm fw-bold">Modifier</a>
                        <button class="btn btn-danger btn-sm fw-bold" data-bs-toggle="modal" data-bs-target="#deleteModal" data-bs-id="@truck.IdTruck">Supprimer</button>
                    </td>
                </tr>
            }
            </tbody>
        </table>
    </div>
</div>

<!-- Modal pour afficher l'image du camion -->
<div class="modal fade" id="viewTruckImageModal" tabindex="-1" aria-labelledby="viewTruckImageModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewTruckImageModalLabel">Photo du camion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <img id="truckImage" src="" alt="Photo du camion" class="img-fluid">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
            </div>
        </div>
    </div>
</div>

<!-- Fenêtre modale de confirmation de suppression -->
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">Supprimer le camion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Êtes-vous sûr de vouloir supprimer ce camion ?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                <form id="deleteForm" asp-action="Delete" asp-controller="Truck" method="post">
                    <input type="hidden" name="idTruck" id="idTruckDelete"/>
                    <button type="submit" class="btn btn-danger">Supprimer</button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        const viewTruckImageModal = document.getElementById('viewTruckImageModal');
        viewTruckImageModal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget;
            const imgPath = button.getAttribute('data-bs-img');
            const modalImg = viewTruckImageModal.querySelector('#truckImage');
            modalImg.src = imgPath;
        });
        
        const deleteModal = document.getElementById('deleteModal');
            deleteModal.addEventListener('show.bs.modal', function (event) {
                const button = event.relatedTarget;
                const truckId = button.getAttribute('data-bs-id');
                const hiddenIdInput = document.getElementById('idTruckDelete');
                hiddenIdInput.value = truckId;
        });
    </script>
}